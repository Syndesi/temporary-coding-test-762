name: database

services:
  mariadb:
    container_name: mariadb
    image: mariadb:12.1.2
    restart: unless-stopped
    environment:
      # note: credentials should not be hardcoded in generated configurations; replace with more secure alternative for
      #       production deployments
      MARIADB_ROOT_PASSWORD: {{ mariadb_root_password }}
    volumes:
      - ./mariadb:/var/lib/mysql
      - ./initialize-database.sql:/docker-entrypoint-initdb.d/initialize-database.sql
      - ./mariadb.cnf:/etc/mysql/mariadb.conf.d/99-mariadb-ansible.cnf
    ports:
      - "{{ ip_internal }}:3306:3306"

  maxscale:
    container_name: maxscale
    image: mariadb/maxscale:24.02.8
    restart: unless-stopped
    ports:
      - "{{ ip_internal }}:8989:8989"
      - "{{ ip_internal }}:3307:3307"
    volumes:
      - ./maxscale.cnf:/etc/maxscale.cnf
      - ./maxscale-data:/var/lib/maxscale
      - ./maxscale-logs:/var/log/maxscale
    environment:
      MAXSCALE_LOGDIR: /var/log/maxscale
      MAXSCALE_PIDFILE: /var/run/maxscale.pid
